-- Таблица семейств животных
CREATE TABLE Семейства (
    ID_семейства INT PRIMARY KEY IDENTITY(1,1),
    Название_семейства NVARCHAR(100) NOT NULL UNIQUE,
    Описание NVARCHAR(500)
);

-- Таблица континентов
CREATE TABLE Континенты (
    ID_континента INT PRIMARY KEY IDENTITY(1,1),
    Название_континента NVARCHAR(50) NOT NULL UNIQUE
);

-- Таблица видов животных
CREATE TABLE Виды_животных (
    ID_вида INT PRIMARY KEY IDENTITY(1,1),
    Название_вида NVARCHAR(100) NOT NULL UNIQUE,
    ID_семейства INT NOT NULL,
    ID_континента INT NOT NULL,
    Суточное_потребление_корма DECIMAL(10,2) NOT NULL CHECK (Суточное_потребление_корма > 0),
    FOREIGN KEY (ID_семейства) REFERENCES Семейства(ID_семейства),
    FOREIGN KEY (ID_континента) REFERENCES Континенты(ID_континента)
);

-- Таблица комплексов/помещений
CREATE TABLE Комплексы (
    ID_комплекса INT PRIMARY KEY IDENTITY(1,1),
    Название_комплекса NVARCHAR(100) NOT NULL,
    Номер_помещения NVARCHAR(20) NOT NULL,
    Наличие_водоема BIT DEFAULT 0,
    Отопление BIT DEFAULT 0,
    Вместимость INT NOT NULL CHECK (Вместимость > 0),
    UNIQUE (Название_комплекса, Номер_помещения)
);

-- Таблица размещения животных
CREATE TABLE Размещение_животных (
    ID_размещения INT PRIMARY KEY IDENTITY(1,1),
    ID_вида INT NOT NULL,
    ID_комплекса INT NOT NULL,
    Количество_особей INT NOT NULL CHECK (Количество_особей > 0),
    Дата_заселения DATE NOT NULL,
    FOREIGN KEY (ID_вида) REFERENCES Виды_животных(ID_вида),
    FOREIGN KEY (ID_комплекса) REFERENCES Комплексы(ID_комплекса)
);

-- Таблица размножения животных
CREATE TABLE Размножение (
    ID_размножения INT PRIMARY KEY IDENTITY(1,1),
    ID_вида INT NOT NULL,
    ID_комплекса INT NOT NULL,
    Дата_размножения DATE NOT NULL,
    Количество_потомства INT NOT NULL CHECK (Количество_потомства > 0),
    FOREIGN KEY (ID_вида) REFERENCES Виды_животных(ID_вида),
    FOREIGN KEY (ID_комплекса) REFERENCES Комплексы(ID_комплекса)
);
-- Заполнение семейств
INSERT INTO Семейства (Название_семейства, Описание) VALUES
('Приматы', 'Млекопитающие с развитым мозгом и цепкими конечностями'),
('Псовые', 'Хищные млекопитающие, включая волков, лисиц и собак'),
('Кошачьи', 'Хищные млекопитающие, включая львов, тигров и домашних кошек'),
('Бегемотовые', 'Крупные травоядные млекопитающие, живущие в воде'),
('Медвежьи', 'Крупные всеядные млекопитающие');

-- Заполнение континентов
INSERT INTO Континенты (Название_континента) VALUES
('Африка'),
('Азия'),
('Европа'),
('Северная Америка'),
('Южная Америка'),
('Австралия'),
('Антарктида');

-- Заполнение видов животных
INSERT INTO Виды_животных (Название_вида, ID_семейства, ID_континента, Суточное_потребление_корма) VALUES
('Обыкновенный шимпанзе', 1, 1, 3.5),
('Карликовый гиппопотам', 4, 1, 12.0),
('Серый волк', 2, 3, 5.0),
('Рыжая лисица', 2, 3, 2.5),
('Амурский тигр', 3, 2, 8.0),
('Лев', 3, 1, 10.0),
('Орангутан', 1, 2, 4.0);

-- Заполнение комплексов
INSERT INTO Комплексы (Название_комплекса, Номер_помещения, Наличие_водоема, Отопление, Вместимость) VALUES
('Приматы', 'P-101', 0, 1, 10),
('Приматы', 'P-102', 1, 1, 8),
('Хищники', 'H-201', 0, 1, 6),
('Хищники', 'H-202', 1, 1, 5),
('Водные животные', 'W-301', 1, 1, 4),
('Водные животные', 'W-302', 1, 1, 3);

-- Заполнение размещения животных
INSERT INTO Размещение_животных (ID_вида, ID_комплекса, Количество_особей, Дата_заселения) VALUES
(1, 1, 3, '2022-01-15'),
(1, 2, 2, '2022-02-20'),
(2, 5, 1, '2021-11-10'),
(3, 3, 2, '2022-03-05'),
(4, 4, 1, '2022-04-12'),
(5, 3, 1, '2021-10-25'),
(6, 4, 1, '2022-05-30'),
(7, 1, 2, '2022-06-15'),
(2, 6, 1, '2022-07-01');

-- Заполнение размножения животных
INSERT INTO Размножение (ID_вида, ID_комплекса, Дата_размножения, Количество_потомства) VALUES
(1, 1, '2022-09-10', 1),
(2, 5, '2022-08-15', 1),
(2, 6, '2022-10-05', 1),
(3, 3, '2022-07-20', 3),
(7, 1, '2022-11-12', 1);

SELECT 
    SUM(вж.Суточное_потребление_корма * рж.Количество_особей) AS Общее_суточное_потребление_корма
FROM 
    Размещение_животных рж
JOIN 
    Виды_животных вж ON рж.ID_вида = вж.ID_вида
JOIN 
    Комплексы к ON рж.ID_комплекса = к.ID_комплекса
WHERE 
    к.Название_комплекса = 'Приматы';

	SELECT 
    SUM(рж.Количество_особей) AS Общая_численность
FROM 
    Размещение_животных рж
JOIN 
    Виды_животных вж ON рж.ID_вида = вж.ID_вида
JOIN 
    Семейства с ON вж.ID_семейства = с.ID_семейства
WHERE 
    с.Название_семейства = 'Псовые';