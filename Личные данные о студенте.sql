-- Таблица факультетов
CREATE TABLE Факультеты (
    ID_факультета INT PRIMARY KEY IDENTITY(1,1),
    Название_факультета NVARCHAR(100) NOT NULL,
    Количество_мест INT NOT NULL CHECK (Количество_мест > 0),
    Описание NVARCHAR(255)
);

-- Таблица групп
CREATE TABLE Группы (
    ID_группы INT PRIMARY KEY IDENTITY(1,1),
    Номер_группы NVARCHAR(20) NOT NULL,
    ID_факультета INT NOT NULL,
    Год_формирования INT NOT NULL CHECK (Год_формирования > 1900),
    FOREIGN KEY (ID_факультета) REFERENCES Факультеты(ID_факультета)
);

-- Таблица студентов
CREATE TABLE Студенты (
    ID_студента INT PRIMARY KEY IDENTITY(1,1),
    Фамилия NVARCHAR(50) NOT NULL,
    Имя NVARCHAR(50) NOT NULL,
    Отчество NVARCHAR(50),
    Дата_рождения DATE NOT NULL,
    ID_семейного_положения INT,
    Сведения_о_семье NVARCHAR(500),
);

-- Таблица обучения (связь студентов, групп и специальностей)
CREATE TABLE Обучение (
    ID_обучения INT PRIMARY KEY IDENTITY(1,1),
    ID_студента INT NOT NULL,
    ID_группы INT NOT NULL,
    ID_специальности INT NOT NULL,
    Курс INT NOT NULL CHECK (Курс BETWEEN 1 AND 6),
    Стипендия DECIMAL(10,2) CHECK (Стипендия >= 0),
    Год_зачисления INT NOT NULL CHECK (Год_зачисления > 1900),
    FOREIGN KEY (ID_студента) REFERENCES Студенты(ID_студента),
    FOREIGN KEY (ID_группы) REFERENCES Группы(ID_группы),
    UNIQUE (ID_студента, ID_группы, ID_специальности)
);
-- Добавление факультетов
INSERT INTO Факультеты (Название_факультета, Количество_мест, Описание) VALUES
('Факультет информационных технологий', 150, 'Факультет подготовки специалистов в области ИТ'),
('Факультет экономики и управления', 200, 'Факультет экономического образования'),
('Факультет гуманитарных наук', 180, 'Факультет гуманитарного образования');

-- Добавление групп
INSERT INTO Группы (Номер_группы, ID_факультета, Год_формирования) VALUES
('ИТ-101', 1, 2024),
('ЭК-201', 2, 2024),
('ГН-301', 3, 2024),
('ИТ-102', 1, 2024),
('ЭК-202', 2, 2024);

-- Добавление студентов
INSERT INTO Студенты (Фамилия, Имя, Отчество, Дата_рождения, ID_семейного_положения, Сведения_о_семье) VALUES
('Иванов', 'Иван', 'Петрович', '2005-05-15', 1, 'Живет с родителями'),
('Петрова', 'Мария', 'Сергеевна', '2005-08-20', 2, 'Живет в общежитии'),
('Сидоров', 'Алексей', 'Николаевич', '2005-02-10', 1, 'Живет с родителями'),
('Козлова', 'Анна', 'Владимировна', '2005-11-25', 3, 'Живет в общежитии'),
('Николаев', 'Дмитрий', 'Алексеевич', '2005-06-15', 1, 'Живет с родителями');

-- Добавление записей об обучении
INSERT INTO Обучение (ID_студента, ID_группы, ID_специальности, Курс, Стипендия, Год_зачисления) VALUES
(1, 1, 101, 1, 1500.00, 2024),
(2, 2, 201, 1, 1200.00, 2024),
(3, 1, 101, 1, 1500.00, 2024),
(4, 3, 301, 1, 1000.00, 2024),
(5, 2, 201, 1, 1200.00, 2024);

SELECT 
    Курс, 
    COUNT(*) AS Количество_студентов
FROM 
    Обучение
GROUP BY 
    Курс
ORDER BY 
    Курс;

	SELECT 
    g.Номер_группы,
    SUM(o.Стипендия) AS Суммарная_стипендия
FROM 
    Обучение o
JOIN 
    Группы g ON o.ID_группы = g.ID_группы
GROUP BY 
    g.Номер_группы
ORDER BY 
    g.Номер_группы;

	SELECT 
    g.Номер_группы,
    COUNT(o.ID_студента) AS Численность_студентов
FROM 
    Группы g
JOIN 
    Факультеты f ON g.ID_факультета = f.ID_факультета
LEFT JOIN 
    Обучение o ON g.ID_группы = o.ID_группы
WHERE 
    f.Название_факультета = 'АП'
GROUP BY 
    g.Номер_группы
ORDER BY 
    g.Номер_группы;